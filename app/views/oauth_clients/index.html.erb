<% content_for :heading do %>
  <h1><%= t'oauth_clients.index.title' %></h1>
<% end %>

<% unless @tokens.empty? %>
<div id="authorised_applications">
  <h3><%= t'oauth_clients.index.my_tokens' %></h3>
  <p><%= t'oauth_clients.index.list_tokens' %></p>
  <table>
    <tr>
      <th><%= t'oauth_clients.index.application' %></th>
      <th><%= t'oauth_clients.index.first_authorised' %></th>
      <th>&nbsp;</th>
    </tr>
    <% @tokens.group_by { |t| t.client_application }.each do |client,tokens|%>
    <%= content_tag_for :tr, client do %>
      <td><%= link_to client.name, client.url %></td>
      <td><%= tokens.min_by { |t| t.authorized_at }.authorized_at %></td>
      <td>
        <%= form_tag :controller => 'oauth', :action => 'revoke' do %>
        <%= hidden_field_tag 'application', client.id %>
        <%= submit_tag t('oauth_clients.index.revoke') %>
        <% end %>
      </td>
    <% end %>
    <% end %>
  </table>
</div>
<% end %>

<div id="client_applications">
  <h3><%= t'oauth_clients.index.my_apps' %></h3>
  <% if @client_applications.empty? %>
  <p><%= raw(t('oauth_clients.index.no_apps', :oauth => "<a href=\"http://oauth.net\">OAuth</a>")) %></p>
  <% else %>
  <p><%= t'oauth_clients.index.registered_apps' %></p>
  <% @client_applications.each do |client|%>
    <%= div_for client do %>
      <%= link_to client.name, :action => :show, :id => client.id %>
    <% end %>
  <% end %>
  <% end %>
  <h3><%= link_to t('oauth_clients.index.register_new'), :action => :new %></h3>
</div>
